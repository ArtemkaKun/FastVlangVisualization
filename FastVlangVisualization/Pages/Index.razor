@page "/"
@using FastVlangVisualization.DataGrabSystem
@using FastVlangVisualization.DataGrabSystem.PerformanceTestDataSystem
@using FastVlangVisualization.DataProcessorSystem

<PageTitle>Index</PageTitle>

@if (VlangTestsDataProcessor == null)
{
    <p>
        <em>Loading...</em>
    </p>
}
else
{
    @foreach ((string? testName, List<IPerformanceTestData>? testResults) in VlangTestsDataProcessor.GroupedTestResultsMap)
    {
        <div >
            <RadzenChart>
                <RadzenLineSeries Smooth="false" Data="@testResults" CategoryProperty="Timestamp" Title="@testName" ValueProperty="PerformanceResultNumericValue">
                    <RadzenMarkers MarkerType="MarkerType.None"/>
                </RadzenLineSeries>
                <RadzenCategoryAxis Padding="20" FormatString="{0:dd/MM/y}"/>
                <RadzenValueAxis Formatter="@testResults[0].FormatValue">
                    <RadzenGridLines Visible="true"/>
                </RadzenValueAxis>
            </RadzenChart>
        </div>
    }
}

@code {
    private IDataProcessor VlangTestsDataProcessor { get; set; }

    protected override async Task OnInitializedAsync ()
    {
        List<IPerformanceTestData> testResultsData = await new FastVlangWebPageDataGrabber("https://fast.vlang.io/").GetVlangSpeedDataAsync();
        VlangTestsDataProcessor = new VlangDataProcessor(testResultsData);
    }
}